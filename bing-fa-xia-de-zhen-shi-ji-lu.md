通过表设计防止并发导致数据错乱
- 需求点
    【签到功能】 一天一个用户只能签到一次，
    签到成功后用户获取到一个积分
- 已知表
用户表，包含积分字段

在高并发的情况下，会导致，一个用户签到记录会有多条，或者用户签到后不止加一积分。
- 我的设计

首先根据需求我会添加一张签到记录表，重点来了，这张表需要把用户唯一标识字段(ID,Token)和签到日期字段添加为唯一约束，或者唯一索引，这样就可以防止并发的时候插入重复用户的签到记录。然后再程序代码逻辑里，先执行签到数据的添加(这里可以防止并发，添加成功后再进行积分的添加，这样就可以防止重复的添加积分了。最后我还是建议所有的数据操作都写在一个sql事务里面， 这样在添加失败，或者编辑用户积分失败的时候可以回滚数据。
***
事务+通过更新锁 防止并发导致数据错乱 或者事物+Update的锁表机制

- 需求点：

【抽奖功能】 抽奖一次消耗一个积分 抽奖中奖后编辑剩余奖品总数 剩余奖品总数为0，或者用户积分为0的时候无法进行抽奖
- 已知表:

用户表，包含积分字段 奖品表，包含奖品剩余数量字段
高并发意淫分析(属于开发前的猜测):
在高并发的情况下，会导致用户参与抽奖的时候积分被扣除，而奖品实际上已经被抽完了
- 我的设计:

在事物里，通过WITH (UPDLOCK) 锁住商品表，或者Update 表的奖品剩余数量和最后编辑时间字段，来把数据行锁住，然后进行用户积分的消耗，都完成后提交事物，失败就回滚。 这样就可以保证，只有可能存在一个操作在操作这件商品的数量，只有等到这个操作事物提交后，其他的操作这个商品行的事物才会继续执行。
***
