## 详见:https://mp.weixin.qq.com/s/Dnwdapt0zTZs04hbw0M_KQ





共识机制:就是所有记账节点之间如何达成共识，去认定一个记录的有效性，这既是认定的手段，也是防止篡改的手段。目前主要有四大类共识机制：**PoW**、**PoS**、**DPoS**和**分布式一致性**算法。

#### PoW（Proofof Work，工作量证明）

PoW机制，也就是像比特币的挖矿机制，矿工通过把网络尚未记录的现有交易打包到一个区块，然后不断遍历尝试来寻找一个随机数，使得新区块加上随机数的哈希值满足一定的难度条件。找到满足条件的随机数，就相当于确定了区块链最新的一个区块，也相当于获得了区块链的本轮记账权。矿工把满足挖矿难度条件的区块在网络中广播出去，全网其他节点在验证该区块满足挖矿难度条件，同时区块里的交易数据符合协议规范后，将各自把该区块链接到自己版本的区块链上，从而在全网形成对当前网络状态的共识。

**优点**：完全去中心化，节点自由进出，避免了建立和维护中心化信用机构的成本。只要网络破坏者的算力不超过网络总算力的50%，网络的交易状态就能达成一致。

**缺点**：目前比特币挖矿造成大量的资源浪费；另外挖矿的激励机制也造成矿池算力的高度集中，背离了当初去中心化设计的初衷。更大的问题是PoW机制的共识达成的周期较长，每秒只能最多做7笔交易，不适合商业应用。


#### PoS（Proofof Stake，权益证明）

PoS机制，要求节点提供拥有一定数量的代币证明来获取竞争区块链记账权的一种分布式共识机制。如果单纯依靠代币余额来决定记账者必然使得富有者胜出，导致记账权的中心化，降低共识的公正性，因此不同的PoS机制在权益证明的基础上，采用不同方式来增加记账权的随机性来避免中心化。例如点点币（Peer Coin）PoS机制中，拥有最多链龄长的比特币获得记账权的几率就越大。NXT和Blackcoin则采用一个公式来预测下一记账的节点。拥有多的代币被选为记账节点的概率就会大。未来以太坊也会从目前的PoW机制转换到PoS机制，从目前看到的资料看，以太坊的PoS机制将采用节点下赌注来赌下一个区块，赌中者有额外以太币奖，赌不中者会被扣以太币的方式来达成下一区块的共识。

**优点**：在一定程度上缩短了共识达成的时间，降低了PoW机制的资源浪费。

**缺点**：破坏者对网络攻击的成本低，网络的安全性有待验证。另外拥有代币数量大的节点获得记账权的几率更大，会使得网络的共识受少数富裕账户支配，从而失去公正性。


#### DPoS（DelegatedProof-Of-Stake，股份授权证明）

DPoS很容易理解，类似于现代企业董事会制度。比特股采用的DPoS机制是由持股者投票选出一定数量的见证人，每个见证人按序有两秒的权限时间生成区块，若见证人在给定的时间片不能生成区块，区块生成权限交给下一个时间片对应的见证人。持股人可以随时通过投票更换这些见证人。DPoS的这种设计使得区块的生成更为快速，也更加节能。

从某种角度来说，DPOS可以理解为多中心系统，兼具去中心化和中心化优势。

**优点**：大幅缩小参与验证和记账节点的数量，可以达到秒级的共识验证。

**缺点**：选举固定数量的见证人作记账候选人有可能不适合于完全去中心化的场景。另外在网络节点数少的场景，选举的见证人的代表性也不强。


####分布式一致性算法

分布式一致性算法是基于传统的分布式一致性技术。其中有分为解决拜占庭将军问题的拜占庭容错算法，如PBFT（拜占庭容错算法）。另外解决非拜占庭问题的分布式一致性算法（Pasox、Raft），详细算法本文不做说明。该类算法目前是联盟链和私有链场景中常用的共识机制。

**优点**：实现秒级的快速共识机制，保证一致性。

**缺点**：去中心化程度不如公有链上的共识机制；更适合多方参与的多中心商业模式。

### 综合来看， POW适合应用于公链，如果搭建私链，因为不存在验证节点的信任问题，可以采用POS比较合适；而联盟链由于存在不可信局部节点，采用DPOS比较合适。


pbft:https://www.jianshu.com/p/fb5edf031afd
http://www.8btc.com/pbft



3.PBFT ：Practical Byzantine Fault Tolerance，实用拜占庭容错介绍：在保证活性和安全性（liveness & safety）的前提下提供了(n-1)/3的容错性。在分布式计算上，不同的计算机透过讯息交换，尝试达成共识；但有时候，系统上协调计算机（Coordinator / Commander）或成员计算机 （Member /Lieutanent）可能因系统错误并交换错的讯息，导致影响最终的系统一致性。拜占庭将军问题就根据错误计算机的数量，寻找可能的解决办法，这无法找到一个绝对的答案，但只可以用来验证一个机制的有效程度。而拜占庭问题的可能解决方法为：在 N ≥ 3F + 1 的情况下一致性是可能解决。其中，N为计算机总数，F为有问题计算机总数。信息在计算机间互相交换后，各计算机列出所有得到的信息，以大多数的结果作为解决办法。1）系统运转可以脱离币的存在，pbft算法共识各节点由业务的参与方或者监管方组成，安全性与稳定性由业务相关方保证。2）共识的时延大约在2~5秒钟，基本达到商用实时处理的要求。3）共识效率高，可满足高频交易量的需求。缺点：1)当有1/3或以上记账人停止工作后，系统将无法提供服务；　　2)当有1/3或以上记账人联合作恶，且其它所有的记账人被恰好分割为两个网络孤岛时，恶意记账人可以使系统出现分叉，但是会留下密码学证据；下面说两个国产的吧~4.dBFT： delegated BFT 授权拜占庭容错算法介绍：小蚁采用的dBFT机制，是由权益来选出记账人，然后记账人之间通过拜占庭容错算法来达成共识。此算法在PBFT基础上进行了以下改进：将C/S架构的请求响应模式，改进为适合P2P网络的对等节点模式；将静态的共识参与节点改进为可动态进入、退出的动态共识参与节点；为共识参与节点的产生设计了一套基于持有权益比例的投票机制，通过投票决定共识参与节点（记账节点）；在区块链中引入数字证书，解决了投票中对记账节点真实身份的认证问题。优点：　　1)专业化的记账人；　　2)可以容忍任何类型的错误；　　3)记账由多人协同完成，每一个区块都有最终性，不会分叉；　　4)算法的可靠性有严格的数学证明；缺点：　　1)当有1/3或以上记账人停止工作后，系统将无法提供服务；　　2)当有1/3或以上记账人联合作恶，且其它所有的记账人被恰好分割为两个网络孤岛时，恶意记账人可以使系统出现分叉，但是会留下密码学证据；　　以上总结来说，dBFT机制最核心的一点，就是最大限度地确保系统的最终性，使区块链能够适用于真正的金融应用场景。5.POOL验证池基于传统的分布式一致性技术，加上数据验证机制。优点：不需要代币也可以工作，在成熟的分布式一致性算法（Pasox、Raft）基础上，实现秒级共识验证。缺点：去中心化程度不如bictoin；更适合多方参与的多中心商业模式。